---
title: "TheHackerLabs - Avanzado : [Cachopo]"
date: 2024-08-12 13:35:00 +0200
categories: [CTF, Writeups, TheHackerLabs, Linux, Avanzado]
description: "Explora el desaf칤o CTF 'Cachopo', dise침ado para usuarios avanzados en un entorno Linux."
tags: [CTF, Writeups, TheHackerLabs, Linux, Avanzado]
image: /img/posts/CTF/cachopo/cachopo.png
---

# Writeup: TheHackerLabs - Cachopo

## Introducci칩n

En este writeup exploraremos el desaf칤o **Cachopo**, un CTF avanzado dise침ado para usuarios con experiencia en Linux y t칠cnicas de hacking. Este reto ofrece una experiencia inmersiva y desafiante que pondr치 a prueba nuestras habilidades de enumeraci칩n, an치lisis forense y explotaci칩n de vulnerabilidades en diversos servicios.

---

## 1. Entorno Inicial

**Sistema objetivo:** M치quina Linux simulada en un entorno local.  
**Direcci칩n IP asignada:** Se obtiene mediante herramientas de descubrimiento de red.  

游깷 [**Consiguiendo la IP de la V칤ctima en CTFs**](/posts/consiguiendo-la-ip-victima-CTF/){:target="_blank"}

**Objetivo:** Identificar servicios vulnerables, explotarlos y capturar la flag final.

---

## 2. Enumeraci칩n de la Red

### Identificaci칩n de la M치quina Objetivo

Utilizamos `arp-scan` para identificar la direcci칩n IP de la v칤ctima dentro de nuestra red local.

```bash
# arp-scan -I ens36 --localnet
Interface: ens36, type: EN10MB, MAC: 00:0c:29:27:66:15, IPv4: 172.18.0.133
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
172.18.0.1    00:50:56:c0:00:08    VMware, Inc.
172.18.0.2    00:50:56:f0:e7:9f    VMware, Inc.
172.18.0.134  00:0c:29:f3:5c:ae    VMware, Inc.
172.18.0.254  00:50:56:f8:f4:23    VMware, Inc.
```

La direcci칩n IP de la m치quina objetivo es **172.18.0.134**.

---

### Escaneo de Puertos con Nmap

Realizamos un escaneo exhaustivo de todos los puertos para identificar servicios activos.

```bash
# nmap -p- --min-rate 2000 -sS -vvv -Pn -oN allports 172.18.0.134
```

**Resultados del Escaneo:**
```bash
Nmap scan report for 172.18.0.134
Host is up, received arp-response (0.00062s latency).
Scanned at 2024-08-11 12:09:28 CEST for 15s
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack ttl 64
80/tcp open  http    syn-ack ttl 64
MAC Address: 00:0C:29:F3:5C:AE (VMware)
```

Identificamos dos puertos abiertos:
- **22/tcp:** Servicio SSH.
- **80/tcp:** Servidor HTTP.

---

## 3. An치lisis del Servidor Web

### Configuraci칩n del Host

El an치lisis inicial revel칩 que el servidor HTTP redirige a un dominio: `http://cachopo.thl/`. Para acceder correctamente, a침adimos el dominio al archivo `/etc/hosts`.

```bash
# echo "172.18.0.134 cachopo.thl" | tee -a /etc/hosts
```

Verificamos la 칰ltima l칤nea del archivo para confirmar la entrada:

```bash
# tail -n 1 /etc/hosts
172.18.0.134 cachopo.thl
```

---

### B칰squeda de Datos Ocultos con Steghide

El sitio web conten칤a una imagen sospechosa. Utilizamos **Steghide** para analizarla en busca de datos ocultos.

```bash
# steghide --extract -sf /home/oscar/Descargas/cachopo.jpg
```

Sin embargo, se solicitaba una contrase침a. Procedimos a realizar un ataque de fuerza bruta utilizando la lista `rockyou.txt`.

---

### Fuerza Bruta con Rockyou

Creamos un script para probar todas las contrase침as de la lista contra la imagen.

**Script: `cachopo.sh`**
```bash
#!/bin/bash
rockyou="/usr/share/wordlists/rockyou.txt"
jpgfile="/home/oscar/Descargas/cachopo.jpg"
output=""
while IFS= read -r password; do
    output=$(steghide --extract -sf "$jpgfile" -p "$password" 2>&1)
    if [[ $output == *"salvoconducto"* ]]; then
        echo -ne "Probando la contrase침a: $password\r"
    else
        echo -e "\n------------------------------------"
        echo -e "\nContrase침a encontrada: $password"
        break
    fi
done < "$rockyou"
```

Ejecutamos el script:

```bash
# chmod +x cachopo.sh
# ./cachopo.sh
Probando la contrase침a: elisazrch
----------------------------------

Contrase침a encontrada: doggies
```

Con la contrase침a `doggies`, extraemos los datos ocultos de la imagen.

---

## 4. Escalaci칩n de Privilegios

### Conexi칩n SSH

Nos conectamos al servidor usando el servicio SSH:

```bash
# ssh carlos@172.18.0.134
```

---

### Escalaci칩n con un Binario Vulnerable

El comando `sudo -l` revel칩 un binario que pod칤a ejecutarse con privilegios sin contrase침a:

```bash
$ sudo -l
User carlos may run the following commands on Cachopo:
    (ALL) NOPASSWD: /usr/bin/crash
```

Usamos este binario para escalar privilegios a root, siguiendo las instrucciones de [GTFOBins](https://gtfobins.github.io/gtfobins/crash/).

---

## 5. Reflexi칩n Final

El desaf칤o **Cachopo** destac칩 la importancia de la enumeraci칩n detallada y el an치lisis forense en CTFs. Fue un ejercicio excelente para reforzar habilidades en:

- An치lisis de redes.
- Uso de herramientas de enumeraci칩n.
- Escalaci칩n de privilegios mediante binarios vulnerables.

---

**춰Gracias por leer este writeup!** Si tienes preguntas o comentarios, no dudes en contactarme.  
Un saludo,  
칍scar
